<!DOCTYPE html>
<html lang="ja" class="mdl-js">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/main.css" />
    <script src="../js/current-header.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth__ja.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css" />
    
    <title>子供アプリ</title>
  </head>
  <body>
    <header>
      <h1><a href="../index.html">児童保護</a></h1>
      <nav class="pc-nav">
        <ul class="header-nav">
          <li class="header-nav_item"><a href="../index.html">ホーム</a></li>
          <li class="header-nav_item"><a href="../about.html">私たちについて</a></li>
          <li class="header-nav_item"><a href="../service.html">サービス</a></li>
          <li class="header-nav_item"><a href="../contact.html">お問い合わせ</a></li>
          <li class="header-nav-login"><a href="login.html">Sign in/ Sign up</a></li>
        </ul>
      </nav>
    </header>
    <main>
      <h1>Firebase Authenction Sample 01</h1>
      <div id="auth" lang="en">
        <div class="firebaseui-container firebaseui-page-provider-sign-in firebaseui-id-page-provider-sign-in firebaseui-use-spinner"><div class="firebaseui-card-content">
          <form onsubmit="return false;">
            <ul class="firebaseui-idp-list">
              <li class="firebaseui-list-item">
                <button class="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised firebaseui-idp-google firebaseui-id-idp-button" data-provider-id="google.com" data-upgraded=",MaterialButton">
                  <span class="firebaseui-idp-icon-wrapper">
                    <img class="firebaseui-idp-icon" alt="" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">
                  </span>
                  <span class="firebaseui-idp-text firebaseui-idp-text-long">Sign in with Google</span>
                  <span class="firebaseui-idp-text firebaseui-idp-text-short">Google</span>
                </button>
              </li>
            </ul>
          </form>
        </div>
        <div class="firebaseui-card-footer firebaseui-provider-sign-in-footer">
          <p class="firebaseui-tos firebaseui-tospp-full-message">By continuing, you are indicating that you accept our 
            <a href="javascript:void(0)" class="firebaseui-link firebaseui-tos-link" target="_blank">Terms of Service</a> and <a href="javascript:void(0)" class="firebaseui-link firebaseui-pp-link" target="_blank">Privacy Policy</a>.</p>
          </div>
        </div>
      </div>
  <script src="/__/firebase/7.16.0/firebase-app.js"></script> 
  <script src="/__/firebase/7.16.0/firebase-auth.js"></script> 
  <script src="/__/firebase/init.js"></script> 
  <script type="text/javascript">

    /*
  Firebase Authentcation を使った認証サンプル 01
  Firebase Authentication UI を使い、サインイン用のUIを生成
  ポップアップウィンドウで認証画面を表示、サインイン後元の画面に移動
  サインアウト ボタンと、Googleの表示名をウェルカムメッセージとして表示
  サインアウト 用の関数「signOut」を定義
 
  */

  const ui = new firebaseui.auth.AuthUI(firebase.auth());
  const uiConfig = {
  callbacks: {
    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
      return true;
    },
  },
  signInFlow: 'popup',
  signInSuccessUrl: 'auth-sample01.html',
  signInOptions: [
    firebase.auth.GoogleAuthProvider.PROVIDER_ID,
  ],
  tosUrl: 'sample01.html',
  privacyPolicyUrl: 'auth-sample01.html'
  };

  ui.start('#auth', uiConfig);

  ui.start('#firebaseui-auth-container', {
    signInOptions: [
      firebase.auth.EmailAuthProvider.PROVIDER_ID
    ],
    // Other config options...
  });

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
        const signOutMessage = `
        <p>Hello, ${user.displayName}!<\/p>
        <button type="submit"  onClick="signOut()">サインアウト<\/button>
        `;
        document.getElementById('auth').innerHTML =  signOutMessage;
        console.log('ログインしています');

    } 
  });

  function signOut() {
  firebase.auth().onAuthStateChanged(user => {
    firebase
      .auth()
      .signOut()
      .then(() => {
        console.log('ログアウトしました');
        location.reload();
      })
      .catch((error) => {
        console.log(`ログアウト時にエラーが発生しました (${error})`);
      });
  });
  }

  </script>
    </main>
  </body>
</html>
